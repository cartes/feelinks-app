{% extends "base_dashboard.html" %}
{% block title %}Editar perfil | feelinks.app{% endblock %}
{% block content %}
    <h1 class="text-2xl font-bold mb-6">Editar perfil</h1>

    <form method="POST" class="grid gap-6 max-w-2xl" id="profile-form" enctype="multipart/form-data">
        {% csrf_token %}
        <div>
            <label class="block mb-1 text-sm font-medium">Nombre para mostrar</label>
            {{ form.display_name }}
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">Biografía</label>
            {{ form.bio }}
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">Avatar (URL)</label>
            {{ form.avatar }}
            {% if profile.avatar %}
                <div class="mt-2">
                    <img src="{{ profile.avatar.url }}" class="w-24 h-24 rounded-full border mt-2" />
                </div>
            {% endif %}
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">Tema</label>
            {{ form.theme }}
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">Tipografía</label>
            {{ form.font_family }}
        </div>


        <div id="customColors" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium">Fondo</label>
                {{ form.background_color }}
            </div>
            <div>
                <label class="block text-sm font-medium">Texto</label>
                {{ form.text_color }}
            </div>
            <div>
                <label class="block text-sm font-medium">Principal</label>
                {{ form.primary_color }}
            </div>
        </div>

        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
    </form>

    <!-- Vista previa -->
    <div class="mt-10 border-t pt-6">
        <h2 class="text-lg font-semibold mb-2">Vista previa</h2>
        <div id="previewBox" class="rounded-lg p-6 text-center shadow font-sans"
             style="background-color: {{ request.user.profile.background_color }};
                     color: {{ request.user.profile.text_color }};">
            <img id="previewAvatar" src="{{ request.user.profile.avatar_url }}"
                 class="w-20 h-20 mx-auto rounded-full mb-3 border"/>
            <h3 class="text-xl font-bold">{{ request.user.profile.display_name|default:request.user.username }}</h3>
            <p class="text-sm mt-2">{{ request.user.profile.bio }}</p>
            <a href="#" class="inline-block mt-4 px-4 py-2 rounded text-white"
               id="previewButton"
               style="background-color: {{ request.user.profile.primary_color }};">Enlace de ejemplo</a>
        </div>
    </div>

    <script>
        const avatarPreview = document.getElementById("avatarPreview");
        const previewAvatar = document.getElementById("previewAvatar");
        const backgroundInput = document.getElementById("id_background_color");
        const textInput = document.getElementById("id_text_color");
        const primaryInput = document.getElementById("id_primary_color");
        const previewBox = document.getElementById("previewBox");
        const previewButton = document.getElementById("previewButton");

        function updatePreview() {
            previewBox.style.backgroundColor = backgroundInput.value;
            previewBox.style.color = textInput.value;
            previewButton.style.backgroundColor = primaryInput.value;
        }

        backgroundInput.addEventListener("input", updatePreview);
        textInput.addEventListener("input", updatePreview);
        primaryInput.addEventListener("input", updatePreview);
        updatePreview();  // inicial
    </script>
    <script>
        const previewBox = document.getElementById("previewBox");
        const fontSelect = document.getElementById("id_font_family");

        function updateFontPreview() {
            const currentFont = Array.from(previewBox.classList).find(c => c.startsWith("font-"));
            if (currentFont) previewBox.classList.remove(currentFont);
            previewBox.classList.add("font-" + fontSelect.value);
        }

        fontSelect.addEventListener("change", updateFontPreview);
        updateFontPreview();  // Ejecuta al cargar
    </script>

{% endblock %}
